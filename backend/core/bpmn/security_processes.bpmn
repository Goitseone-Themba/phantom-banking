<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_2" targetNamespace="http://bpmn.io/schema/bpmn">
  
  <!-- KYC Validation Process -->
  <bpmn:process id="kyc-validation-process" name="KYC Validation Process" isExecutable="true">
    <bpmn:startEvent id="StartEvent_KYC" name="KYC Validation Request">
      <bpmn:outgoing>Flow_KYC_1</bpmn:outgoing>
    </bpmn:startEvent>
    
    <bpmn:sequenceFlow id="Flow_KYC_1" sourceRef="StartEvent_KYC" targetRef="Task_ValidateKYC" />
    
    <bpmn:serviceTask id="Task_ValidateKYC" name="Validate KYC Data" camunda:type="external" camunda:topic="validate-kyc-data">
      <bpmn:incoming>Flow_KYC_1</bpmn:incoming>
      <bpmn:outgoing>Flow_KYC_2</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <bpmn:sequenceFlow id="Flow_KYC_2" sourceRef="Task_ValidateKYC" targetRef="Gateway_KYC" />
    
    <bpmn:exclusiveGateway id="Gateway_KYC" name="Validation Result">
      <bpmn:incoming>Flow_KYC_2</bpmn:incoming>
      <bpmn:outgoing>Flow_KYC_3</bpmn:outgoing>
      <bpmn:outgoing>Flow_KYC_4</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    
    <bpmn:sequenceFlow id="Flow_KYC_3" name="Valid" sourceRef="Gateway_KYC" targetRef="EndEvent_KYC_Success">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${kyc_validation_success == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    
    <bpmn:sequenceFlow id="Flow_KYC_4" name="Invalid" sourceRef="Gateway_KYC" targetRef="EndEvent_KYC_Failed">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${kyc_validation_success == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    
    <bpmn:endEvent id="EndEvent_KYC_Success" name="KYC Validated">
      <bpmn:incoming>Flow_KYC_3</bpmn:incoming>
    </bpmn:endEvent>
    
    <bpmn:endEvent id="EndEvent_KYC_Failed" name="KYC Failed">
      <bpmn:incoming>Flow_KYC_4</bpmn:incoming>
    </bpmn:endEvent>
  </bpmn:process>

  <!-- Merchant Approval Process -->
  <bpmn:process id="merchant-approval-process" name="Merchant Approval Process" isExecutable="true">
    <bpmn:startEvent id="StartEvent_Merchant" name="Merchant Approval Request">
      <bpmn:outgoing>Flow_Merchant_1</bpmn:outgoing>
    </bpmn:startEvent>
    
    <bpmn:sequenceFlow id="Flow_Merchant_1" sourceRef="StartEvent_Merchant" targetRef="Task_ProcessMerchant" />
    
    <bpmn:serviceTask id="Task_ProcessMerchant" name="Process Merchant Approval" camunda:type="external" camunda:topic="process-merchant-approval">
      <bpmn:incoming>Flow_Merchant_1</bpmn:incoming>
      <bpmn:outgoing>Flow_Merchant_2</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <bpmn:sequenceFlow id="Flow_Merchant_2" sourceRef="Task_ProcessMerchant" targetRef="EndEvent_Merchant" />
    
    <bpmn:endEvent id="EndEvent_Merchant" name="Merchant Approved">
      <bpmn:incoming>Flow_Merchant_2</bpmn:incoming>
    </bpmn:endEvent>
  </bpmn:process>

  <!-- Suspicious Activity Process -->
  <bpmn:process id="suspicious-activity-process" name="Suspicious Activity Process" isExecutable="true">
    <bpmn:startEvent id="StartEvent_Suspicious" name="Suspicious Activity Detected">
      <bpmn:outgoing>Flow_Suspicious_1</bpmn:outgoing>
    </bpmn:startEvent>
    
    <bpmn:sequenceFlow id="Flow_Suspicious_1" sourceRef="StartEvent_Suspicious" targetRef="Task_HandleSuspicious" />
    
    <bpmn:serviceTask id="Task_HandleSuspicious" name="Handle Suspicious Activity" camunda:type="external" camunda:topic="handle-suspicious-activity">
      <bpmn:incoming>Flow_Suspicious_1</bpmn:incoming>
      <bpmn:outgoing>Flow_Suspicious_2</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <bpmn:sequenceFlow id="Flow_Suspicious_2" sourceRef="Task_HandleSuspicious" targetRef="EndEvent_Suspicious" />
    
    <bpmn:endEvent id="EndEvent_Suspicious" name="Activity Handled">
      <bpmn:incoming>Flow_Suspicious_2</bpmn:incoming>
    </bpmn:endEvent>
  </bpmn:process>

  <!-- Email Verification Process -->
  <bpmn:process id="email-verification-process" name="Email Verification Process" isExecutable="true">
    <bpmn:startEvent id="StartEvent_Email" name="Email Verification Request">
      <bpmn:outgoing>Flow_Email_1</bpmn:outgoing>
    </bpmn:startEvent>
    
    <bpmn:sequenceFlow id="Flow_Email_1" sourceRef="StartEvent_Email" targetRef="Task_ProcessEmail" />
    
    <bpmn:serviceTask id="Task_ProcessEmail" name="Process Email Verification" camunda:type="external" camunda:topic="process-email-verification">
      <bpmn:incoming>Flow_Email_1</bpmn:incoming>
      <bpmn:outgoing>Flow_Email_2</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <bpmn:sequenceFlow id="Flow_Email_2" sourceRef="Task_ProcessEmail" targetRef="EndEvent_Email" />
    
    <bpmn:endEvent id="EndEvent_Email" name="Verification Sent">
      <bpmn:incoming>Flow_Email_2</bpmn:incoming>
    </bpmn:endEvent>
  </bpmn:process>
  
</bpmn:definitions>